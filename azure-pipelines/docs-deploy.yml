# Documentation Deployment Pipeline
# Equivalent to .github/workflows/gh-deploy.yml
# Note: Adjust deployment target based on your Azure hosting (Azure Static Web Apps, Azure Storage, etc.)

trigger:
  branches:
    include:
      - main
  paths:
    include:
      - "docs/**"
      - ".python-version"
      - "mkdocs.yml"
      - "pyproject.toml"
      - "uv.lock"
      - "azure-pipelines/docs-deploy.yml"

pr:
  branches:
    include:
      - main
  paths:
    include:
      - "docs/**"
      - ".python-version"
      - "mkdocs.yml"
      - "pyproject.toml"
      - "uv.lock"
      - "azure-pipelines/docs-deploy.yml"

pool:
  vmImage: "ubuntu-latest"

jobs:
  - job: BuildDocs
    displayName: "Build MkDocs Documentation"
    steps:
      - checkout: self

      - script: |
          curl -LsSf https://astral.sh/uv/install.sh | sh
          echo "##vso[task.prependpath]$HOME/.cargo/bin"
        displayName: "Install uv"

      - script: |
          uv sync --frozen
        displayName: "Install dependencies with uv"

      - script: |
          uv run mkdocs build
        displayName: "Build Documentation"

      - task: PublishBuildArtifacts@1
        displayName: "Publish Documentation Artifacts"
        inputs:
          pathToPublish: "site"
          artifactName: "documentation"

  # Deployment job - configure based on your hosting solution
  # Example options:
  # 1. Azure Static Web Apps
  # 2. Azure Blob Storage + CDN
  # 3. Azure App Service

  - deployment: DeployDocs
    displayName: "Deploy Documentation"
    dependsOn: BuildDocs
    condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/main'))
    environment: "production"
    strategy:
      runOnce:
        deploy:
          steps:
            - download: current
              artifact: documentation

            # Example: Deploy to Azure Static Web Apps
            # - task: AzureStaticWebApp@0
            #   inputs:
            #     app_location: '$(Pipeline.Workspace)/documentation'
            #     azure_static_web_apps_api_token: $(AZURE_STATIC_WEB_APPS_API_TOKEN)

            # Example: Deploy to Azure Blob Storage
            # - task: AzureCLI@2
            #   inputs:
            #     azureSubscription: 'your-service-connection'
            #     scriptType: 'bash'
            #     scriptLocation: 'inlineScript'
            #     inlineScript: |
            #       az storage blob upload-batch \
            #         --account-name yourstorageaccount \
            #         --destination '$web' \
            #         --source $(Pipeline.Workspace)/documentation

            - script: |
                echo "Configure deployment based on your hosting solution"
                echo "See comments above for Azure Static Web Apps or Blob Storage examples"
              displayName: "Deployment Placeholder"
