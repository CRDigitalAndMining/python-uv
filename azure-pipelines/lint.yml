# Linting Pipeline (Pyright + Ruff)
# Equivalent to .github/workflows/lint.yml

trigger:
  branches:
    include:
      - main
  paths:
    include:
      - "**.py"
      - ".python-version"
      - "pyproject.toml"
      - "pyrightconfig.json"
      - "ruff.toml"
      - "uv.lock"
      - "azure-pipelines/lint.yml"

pr:
  branches:
    include:
      - main
  paths:
    include:
      - "**.py"
      - ".python-version"
      - "pyproject.toml"
      - "pyrightconfig.json"
      - "ruff.toml"
      - "uv.lock"
      - "azure-pipelines/lint.yml"

pool:
  vmImage: "ubuntu-latest"

jobs:
  - job: Pyright
    displayName: "Type Checking with Pyright"
    steps:
      - checkout: self

      - script: |
          curl -LsSf https://astral.sh/uv/install.sh | sh
          echo "##vso[task.prependpath]$HOME/.cargo/bin"
        displayName: "Install uv"

      - script: |
          uv sync --frozen
        displayName: "Install dependencies with uv"

      - script: |
          uv run nox -s lint -- --pyright
        displayName: "Run Pyright Type Checking"

  - job: Ruff
    displayName: "Linting with Ruff"
    steps:
      - checkout: self

      - script: |
          curl -LsSf https://astral.sh/uv/install.sh | sh
          echo "##vso[task.prependpath]$HOME/.cargo/bin"
        displayName: "Install uv"

      - script: |
          uv sync --frozen
        displayName: "Install dependencies with uv"

      - script: |
          uv run nox -s lint -- --ruff
        displayName: "Run Ruff Linting"
